<!DOCTYPE html>

<html>

<head>
	<title>Tour of heroes</title>
	<!--script src="http://jooher.github.io/dap/0.4.3.js"></script-->
	<script src="../../0.4.3-.js"></script>
	<link href="styles.css" rel="stylesheet" type="text/css"/>	
	<style>
	.labelled {margin-top:2em; position:relative;}
	.labelled::before{content:attr(label); color:gray; position:absolute; top:-1em;}	
	[contenteditable]{background:wheat;outline:none;}
	
	.hero-icon{display:inline-block; padding:1em; margin:.5em; background:steelblue; color:white;}
	
	.tab{display:inline-block; padding:.5em; margin:.5em; }
	.tab.selected{background:yellow}
	</style>
</head>

<body>

<script>
'toh'.d("$message= $hero= $heroes=heroes"
	,'H1'.d("! dict.apptitle")
	,'lists'.d("? $hero:!; $page=`dashboard"
		,'tabs'.d("* dict.page"
			,'tab'.d("! .page; !? (.page $page)eq@selected").ui("$page=.")
		)
		,'dashboard'.d("?? $page@Dashboard"
			,'H2'.d("! dict.dashboard")
			,'heroes'.d("* $heroes:top5@"
				,'hero-icon'.d("! .name").ui("$hero=$")
			)
			,'search'.d("$match="
				,'input.labelled contenteditable'.d("!! dict.search@label").e("keyup","$match=#:value")
				,'list'.d("? ($heroes $match)!; * ($heroes $match):search"
					,'hero'.d("! .name").ui("$hero=$")
				)
			)
		)
		,'myheroes'.d("?? $page@Heroes"
			,'H2'.d("! dict.myheroes")
			,'heroes'.d("* $heroes@"
				,'hero-bar'.d("! .id"
					,'name'.d("! .name")
					,'del'.d("! `X").ui("$heroes=($heroes .id):remove; ?")
				).ui("$hero=$")
			)
		)
	)
	,'details'.d("? $hero; $name=$hero.name"
		,'H2'.d("! (dict.details $name:upper)space")
		,'id.labelled'.d("! $hero.id; !! dict.id@label")
		,'name.labelled contenteditable'.d("! $hero.name; !! dict.name@label").e("keyup","$name=#:value")
		,'done'.ui("$hero=").d(""
			,'BUTTON.back'.d("! dict.back").ui("")
			,'BUTTON.save'.d("? ($hero.name $name)ne; ! dict.save").ui("$hero.name=$name")
		)
	)
	,'messages'.d("! $message")
)
.EXT({
	convert:{
		upper	:str=>str.toUpperCase(),
		top5	:arr=>arr.slice(0,5),
		search	:$=>$.heroes.filter(h=>h.name.indexOf($.match)>=0),
		remove	:$=>{const hs=$.heroes,i=hs.findIndex(h=>h.id=$.id); return hs.slice(0,i).concat(hs.slice(i+1))}
	}
})
.DEF({
	dict	:{
		apptitle	:"Tour of heroes",
		page		:["Dashboard","Heroes"],
		dashboard	:"Top heroes",
		myheroes	:"My heroes",
		details		:"Details for",
		id			:"Hero ID",
		name		:"Hero name",
		back		:"Go back",
		save		:"Save changes",
		search		:"Hero search"
	},
	
	heroes	:[
		{ id: 11, name: 'Mr. Nice' },
		{ id: 12, name: 'Narco' },
		{ id: 13, name: 'Bombasto' },
		{ id: 14, name: 'Celeritas' },
		{ id: 15, name: 'Magneta' },
		{ id: 16, name: 'RubberMan' },
		{ id: 17, name: 'Dynama' },
		{ id: 18, name: 'Dr IQ' },
		{ id: 19, name: 'Magma' },
		{ id: 20, name: 'Tornado' }
	]
})
.INLINE();
			
</script>
</html>
</body>