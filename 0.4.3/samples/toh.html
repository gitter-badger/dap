<!DOCTYPE html>

<html>

<head>
	<title>Tour of Heroes - dap example</title>
	<!--script src="http://jooher.github.io/dap/0.4.3.js"></script-->
	<script src="../--.js"></script>
	<link href="styles.css" rel="stylesheet" type="text/css"/>	
	<link href="toh.css" rel="stylesheet" type="text/css"/>	
</head>

<body>

<script>
'toh'.d("$message= $hero= $heroes=heroes"
	,'H1'.d("! dict.apptitle")
	,'lists'.d("? $hero:!; $page=`Dashboard"
		,'tabs'.d("* dict.page"
			,'tab'.d("! .page; !? (.page $page)eq@selected").ui("$page=.")
		)
		,'page.dashboard'.d("?? $page@Dashboard"
			,'H2'.d("! dict.dashboard")
			,'heroes'.d("* $heroes:top5@"
				,'hero-icon'.d("! .name").ui("$hero=$")
			)
			,'search'.d("$match="
				,'input.labelled contenteditable'.d("!! dict.search@label").e("keyup","$match=#:value")
				,'list'.d("? ($heroes $match)!; * ($heroes $match):hero.search"
					,'hero'.d("! .name").ui("$hero=$")
				)
			)
		)
		,'page.myheroes'.d("?? $page@Heroes"
			,'H2'.d("! dict.myheroes")
			,'heroes'.d("* $heroes@"
				,'hero-bar'.d(""
					,'id'.d("! .id")
					,'name'.d("! .name")
					,'del'.d("!! `Ã— dict.remove@title").ui("$heroes=($heroes .id):hero.remove; ?")
				).ui("$hero=$")
			)
			,'addnew'.d("$name="
				,'labelled contenteditable'.d("!! dict.addnew@label").e("keyup","$name=#:value")
				,'BUTTON'.d("! dict.addnew").ui("$heroes=($heroes $name):hero.add $name=")
			)
		)
	)
	,'page.details'.d("? $hero; $name=$hero.name"
		,'H2'.d("! (dict.details $name:upper)spaced")
		,'id.labelled'.d("!! $hero.id@ dict.id@label")
		,'name.labelled contenteditable'.d("!! $hero.name@ dict.name@label").e("keyup","$name=#:value")
		,'done'.ui("$hero=").d(""
			,'BUTTON.back'.d("! dict.back").ui("")
			,'BUTTON.save'.d("? ($hero.name $name)ne; ! dict.save").ui("$hero.name=$name")
		)
	)
	,'messages'.d("! $message")
)
.FUNC({
	convert:{
		upper	:str=>str.toUpperCase(),
		top5	:arr=>arr.slice(0,5),
		
		hero	:{
			search	:$=>$.match&&$.heroes.filter(h=>h.name.toLowerCase().indexOf($.match.toLowerCase())>=0),
			remove	:$=>{
				const hs=$.heroes,i=hs.findIndex(h=>h.id==$.id);
				return hs.slice(0,i).concat(hs.slice(i+1));
			},
			add		:$=>{
				const id=$.heroes.reduce((i,h)=>h.id>i?h.id:i,0)+1;
				return $.heroes.concat([{id:id,name:$.name}]);
			}
		}
	}
})
.DICT({
	dict	:{
		apptitle	:"Tour of heroes",
		page		:["Dashboard","Heroes"],
		dashboard	:"Top heroes",
		myheroes	:"My heroes",
		details		:"Details for",
		id			:"Hero ID",
		name		:"Hero name",
		back		:"Go back",
		save		:"Save changes",
		search		:"Hero search",
		remove		:"Remove hero",
		addnew		:"Add new hero"
	},
	
	heroes	:[
		{ id: 11, name: 'Mr. Nice' },
		{ id: 12, name: 'Narco' },
		{ id: 13, name: 'Bombasto' },
		{ id: 14, name: 'Celeritas' },
		{ id: 15, name: 'Magneta' },
		{ id: 16, name: 'RubberMan' },
		{ id: 17, name: 'Dynama' },
		{ id: 18, name: 'Dr IQ' },
		{ id: 19, name: 'Magma' },
		{ id: 20, name: 'Tornado' }
	]
})
.INLINE();
			
</script>
</html>
</body>