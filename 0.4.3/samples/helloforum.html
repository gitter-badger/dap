<!DOCTYPE html>

<html>

<head>
	<title>Hello Forum</title>
	<!--<script src="https://dap.js.org/0.4.3.js"></script>-->
	<script src="../../0.4.3.js"></script>
	<link rel="stylesheet" href="helloforum.css"/>
</head>

<body>
<script>

function reCaptchaReady(){
	grecaptcha.render("grc-container",{
		size	: "invisible",
		sitekey	: "6Lc4_0YUAAAAAAmOA7FOm9VQAkOPss7sR_1ZYG08",
		callback: grc.resolve
	})
}

const	grc={
	execute	: dummy=>grecaptcha.execute(),
	resolve	: token=>grecaptcha.reset()||token
};



'helloforum'.d("! (.msg:# Entry@+ Ties@-)case")

.DEF({
	base	:'https://dapmx.org/samples/helloforum/helloforum.php?',

	Entry	:'msg'.d("$!!=; * (base@ `read.msg .msg)uri:query"
			,'body'.d("! .body")
			,'reply'.d("$?="
				,'action'.d("? $?:!").ui("$?=$?:!")
				,'input'.d("? $?; $author= $head= $body="
					,'message'.d(""
						,'author contenteditable'.ui("$author=#:value")
						,'head contenteditable'.ui("$head=#:value")
						,'body contenteditable'.ui("$body=#:text")
					).u("?")
					,'button.submit'.ui("? ($author $head $body)! (dict.incomplete)alert; $!!=( (base@ `write.msg .msg@tie)uri $author $head $body .g-recaptcha-response:grc)post:query (dict.error)alert")
				).u("$?=")
			).u("?")
			,'ties'.d("$!!; ! Ties")
		),
		
	Ties	:'ties'.d("* (base@ `read.ties .msg)uri:query"
			,'tie'.d("$?="
				,'A.msg'.d("! .msg; !! (`? .msg)uri@href")
				,'date'.d("! .date")
				,'author'.d("! .author")
				,'head'.d("! .head").ui("$?=$?:!")
				,'open'.d("? $?; ! Entry")
			)
		),
		
	dict	:{
		incomplete: "Please, fill in all fields:\nyour name, message head and message body",
		error	: "Server communication error"
		}
})

.EXT({
	convert	:{
		grc:dap.async(grc)
	}
})

.INLINE();

</script>
<div id="grc-container"></div>
</body>

<!--
<script src="https://www.google.com/recaptcha/api.js?onload=reCaptchaReady&render=explicit" async defer></script>
-->