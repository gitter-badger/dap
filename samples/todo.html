<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Todo -- dap sample</title>
	<script src="/0.5.js" _src="https://dap.js.org/0.5.js"></script>
	<link rel="stylesheet" href="https://www.todobackend.com/client/css/vendor/todomvc-common.css"/>
	<style>
		[ui]{cursor:pointer}
		#filters>li {margin:.2em}
		#filters>li:hover{text-decoration:underline}
	</style>
	</style>
</head>

<body>
	<script>
const	active = todo=>!todo.completed,
	completed = todo=>!!todo.completed;
	
	
'#todoapp'.d("$todos= $filter= $patch="
	,'#header'.d(""
		,'H1'.d("! `todos")
		,'INPUT#new-todo placeholder="What needs to be done?" autofocus'
			.ui(".title=#:value $todos=($todos (.title) )append #.value=")
	)
	,'#main'.d(""
		,'#toggle-all type=checkbox'.ui("$todos=$todos:toggle")
		,'UL#todo-list'.d("* ($todos $filter)filter"
			,'LI'.d("$editing= $completed=.; a!"
			
				,'INPUT.toggle type=checkbox'
					.d("#.checked=$completed")
					.ui("$patch=(.completed=$completed=$completed:!)")
					
				,'LABEL.view'
					.d("? $editing:!; ! .title")
					.e("dblclick","$editing=:!; ?")
					
				,'INPUT.edit'
					.d("? $editing; !! .title@value")
					.ui("? (.title .title=#.value)ne; $patch=(.title)")
					.e("blur","$editing=")
					
				,'BUTTON.destroy'
					.ui("(@method`DELETE .url:dehttp):query; $todos=($todos $)remove")
				
			)
			.a("!? $editing $completed")
			.u("? $patch; & (@method`PATCH .url:dehttp headers $patch@):query; $editing= $patch=")
			.d("? .url:!; & (@method`POST todos@url headers $):query")
		)
	)
	,'#footer'.d("$patch $left=$todos:left $done=$todos:done"
		,'#todo-count'.d("! $left.length items-left")
		,'UL#filters'.d("* filters@"
			,'LI'.d("! .title").ui("$filter=.")
		)
		,'#clear-completed'
			.d("! clear-completed $done.length")
			.ui("$todos=$left; { * $done@; ((@method`DELETE .url:dehttp):query) }") // 
	)
	,'loader'.u("$todos=todos:query").d("u")
)

.FUNC({
	convert:{
		done	: todos=>todos&&todos.filter(completed),
		left	: todos=>todos&&todos.filter(active),
		toggle: (state=>todos=>((state=!state)||true)&&todos.map(todo=>{todo.completed=state; return todo;}))(false),
		dehttp: url=>url.replace(/^https?:/,'')
	},
	flatten:{
		filter: values=>values.reduce((a,f)=>f?a&&a.filter(f):a,values.pop()),
		remove: values=>values.reduce((a,del)=>a&&a.filter(r=>r!=del),values.pop()),
		append: values=>values.reduce((a,add)=>a?a.concat(add):[add],values.pop())
	}
})
.DICT({
	todos	:"//todo-backend-express.herokuapp.com/",
	headers: {"Content-type":"application/json"},	
	filters:[
		{title:"All"},
		{title:"Active",filter:active},
		{title:"Completed",filter:completed}
	],
	"items-left": " items left",
	"clear-completed":"Clear completed items: "
})
.RENDER()
	</script>
</body>
</html>
