<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Todo -- dap sample</title>
	<script src="/0.4.js" _src="https://dap.js.org/0.4.js"></script>
	<link rel="stylesheet" href="https://www.todobackend.com/client/css/vendor/todomvc-common.css"/>
	<style>
		.EMPTY{display:none !important}
		[ui]{cursor:pointer}
		#filters>li {margin:.2em}
	</style>
	</style>
</head>

<body>
	<script>
const	active = todo=>!todo.completed,
	completed = todo=>!!todo.completed;
	
'app'.("$all=root:query $filter= $patch="
	,'#todoapp'.d("$active=$all:active $completed=$all:completed"
		,'#header'.d(""
			,'H1'.d("! `todos")
			,'INPUT#new-todo placeholder="What needs to be done?" autofocus'
				.ui("$all=($all (#:value@title) )append #.value= (@method`POST root@url headers :json.encode@body):query")
		)
		,'#main'.d(""
			,'#toggle-all type=checkbox'.ui("$all=$all:toggle")
			,'UL#todo-list'.d("* ($filter $all $active $completed)case"
				,'LI'.d("$editing= $completed=.; a!"
				
					,'INPUT.toggle type=checkbox'
						.d("#.checked=$completed")
						.ui("$patch=($completed=.completed=$completed:!)")
						
					,'LABEL'
						.d("? $editing:!; ! .title")
						.e("dblclick","$editing=:!; ?")
						
					,'INPUT.edit'
						.d("? $editing; !! .title@value")
						.ui("? (.title .title=#.value)ne; $patch=(.title)")
						.e("blur","$editing=")
						
					,'BUTTON.destroy'
						.ui("(@method`DELETE .url):query; $all=($all $)remove")
					
				)
				.a("!? $editing $completed")
				.u("? $patch; (@method`PATCH .url headers $patch:json.encode@body):query $editing= $patch=")
			)
		)
		,'#footer'.d("$patch"
			,'#todo-count'.d("! $left=$all:left items-left")
			,'UL#filters'.d("* filter@"
				,'LI'.d("! .title").ui("$filter=.test")
			)
			,'#clear-completed'
				.d("$done=! clear-completed $all:done")
				.ui("$all=$all:clean; ")
		)
	)
)
.FUNC({
	convert:{
		completed	: todos=>todos.filter(completed),
		active	: todos=>todos.filter(active),
		toggle: (state=>todos=>((state=!state)||true)&&todos.map(todo=>{todo.completed=state; return todo;}))(false)
	},
	flatten:{
		filter: values=>values.reduce((a,f)=>f?a.filter(f):a,values.pop()),
		remove: values=>values.reduce((a,del)=>a.filter(r=>r!=del),values.pop()),
		append: values=>values.reduce((a,add)=>a.concat(add),values.pop())
	}
})
.DICT({

	root	:"https://todo-backend-express.herokuapp.com/",
	headers: {"Content-type":"application/json"},
	
	
	filter: [
		{title:"All"},
		{title:"Active", test: active },
		{title:"Completed", test: completed }
	],
	
	"items-left": " items left",
	"clear-completed":"Clear completed items: "
})
.RENDER()
	</script>
</body>
</html>
