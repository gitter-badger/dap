<!DOCTYPE html>

<html>

<head>
	<title>Tour of Heroes - dap example</title>
	<script src="https://dap.js.org/0.4.js"></script>
	<link href="styles.css" rel="stylesheet" type="text/css"/>	
	<link href="toh.css" rel="stylesheet" type="text/css"/>	
</head>

<body>
<p>This dap example is inspired by <a href="https://angular.io/tutorial/" target="_blank" rel="nofollow">Angular tutorial</a>. Press Ctrl+U to see the source code.</p>

<script>
'toh'.d("$message= $hero= $heroes=heroes"
	,'H1'.d("! dict.apptitle")
	,'lists'.d("? $hero:!; $page=`Dashboard" // if hero is not set: define a $page status variable for switching between pages
		,'tabs'.d("* dict.page" // take page list from dictionary, and for each row of that list, do:
			,'tab'	.d("! .page; !? (.page $page)eq@selected") // create a DIV.tab element, print current .page, and mark the element selected if .page is equal to $page
				.ui("$page=.") // on UI event (click) change $page variable's value to .page of current data row
		)
		,'page.dashboard'.d("?? $page@Dashboard" // if $page is set to "Dashboard"
			,'H2'.d("! dict.dashboard") // print dashboard caption from the dictionary
			,'heroes'.d("* $heroes:top5@" // take top 5 heroes with :top5 converter, and for each of them do:
				,'hero-icon'.d("! .name") // create an icon with a hero's name
					.ui("$hero=$") // on UI event update $hero with the current rowset
			)
			,'search'.d("$match=" // Search panel. Define $match variable
				,'input.labelled contenteditable' // .labelled css class (in styles.css) is defined to show label attribute as contentBefore
					.d("!! dict.search@label") // set this element's label attribute from dictionary
					.e("keyup","$match=#:value") // on every keyup, update $match with value of the element node
				,'list'.d("? ($heroes $match)!; * ($heroes $match):hero.search" // if both $heroes and $match are set, do: search
					,'hero'.d("! .name").ui("$hero=$")
				)
			)
		)
		,'page.myheroes'.d("?? $page@Heroes"
			,'H2'.d("! dict.myheroes")
			,'heroes'.d("* $heroes@"
				,'hero-bar'.d(""
					,'id'.d("! .id")
					,'name'.d("! .name")
					,'del'.d("!! `Ã— dict.remove@title").ui("$heroes=($heroes .id):hero.remove; ?")
				).ui("$hero=$")
			)
			,'addnew'.d("$name="
				,'labelled contenteditable'.d("!! dict.addnew@label").e("keyup","$name=#:value")
				,'BUTTON'.d("! dict.addnew").ui("$heroes=($heroes $name):hero.add $name=")
			)
		)
	)
	,'page.details'.d("? $hero; $name=$hero.name"
		,'H2'.d("! (dict.details $name:upper)spaced")
		,'id.labelled'.d("!! $hero.id@ dict.id@label")
		,'name.labelled contenteditable'.d("!! $hero.name@ dict.name@label").e("keyup","$name=#:value")
		,'done'.ui("$hero=").d(""
			,'BUTTON.back'.d("! dict.back").ui("")
			,'BUTTON.save'.d("? ($hero.name $name)ne; ! dict.save").ui("$hero.name=$name")
		)
	)
	,'messages'.d("! $message")
)
.FUNC({
	convert:{
		upper	:str=>str.toUpperCase(),
		top5	:arr=>arr.slice(0,5),
		
		hero	:{
			search	:$=>$.match&&$.heroes.filter(h=>h.name.toLowerCase().indexOf($.match.toLowerCase())>=0),
			remove	:$=>{
				const hs=$.heroes,i=hs.findIndex(h=>h.id==$.id);
				return hs.slice(0,i).concat(hs.slice(i+1));
			},
			add	:$=>{
				const id=$.heroes.reduce((i,h)=>h.id>i?h.id:i,0)+1;
				return $.heroes.concat([{id:id,name:$.name}]);
			}
		}
	}
})
.DICT({
	dict	:{
		apptitle	:"Tour of heroes",
		page		:["Dashboard","Heroes"],
		dashboard	:"Top heroes",
		myheroes	:"My heroes",
		details		:"Details for",
		id		:"Hero ID",
		name		:"Hero name",
		back		:"Go back",
		save		:"Save changes",
		search		:"Hero search",
		remove		:"Remove hero",
		addnew		:"Add new hero"
	},
	
	heroes	:[
		{ id: 11, name: 'Mr. Nice' },
		{ id: 12, name: 'Narco' },
		{ id: 13, name: 'Bombasto' },
		{ id: 14, name: 'Celeritas' },
		{ id: 15, name: 'Magneta' },
		{ id: 16, name: 'RubberMan' },
		{ id: 17, name: 'Dynama' },
		{ id: 18, name: 'Dr IQ' },
		{ id: 19, name: 'Magma' },
		{ id: 20, name: 'Tornado' }
	]
})
.RENDER();
			
</script>
</html>
</body>